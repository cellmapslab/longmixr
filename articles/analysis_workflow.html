<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="longmixr">
<title>Example clustering analysis • longmixr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example clustering analysis">
<meta property="og:description" content="longmixr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">longmixr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analysis_workflow.html">Example clustering analysis</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cellmapslab/longmixr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="analysis_workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example clustering analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cellmapslab/longmixr/blob/HEAD/vignettes/analysis_workflow.Rmd" class="external-link"><code>vignettes/analysis_workflow.Rmd</code></a></small>
      <div class="d-none name"><code>analysis_workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cellmapslab.github.io/longmixr/">longmixr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://corybrunson.github.io/ggalluvial/" class="external-link">ggalluvial</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://factominer.free.fr" class="external-link">FactoMineR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra" class="external-link">factoextra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></code></pre></div>
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p>This vignette gives an overview how to inspect and prepare the data for a clustering analysis with <code>longmixr</code>, do the clustering and analyse the results.</p>
</div>
<div class="section level1">
<h1 id="consensus-clustering">Consensus clustering<a class="anchor" aria-label="anchor" href="#consensus-clustering"></a>
</h1>
<p>Consensus clustering tries to generate more robust clustering results. Instead of doing the clustering once, the clustering is performed several times on different subsets of the data. In every subset, for all pairs of subjects it is recorded if they cluster together in the same cluster. The average of this information is called the consensus matrix. The final clustering solution is obtained by a hierarchical clustering step using the consensus matrix as its distance matrix.</p>
<p>For an overview about the used consensus clustering methodology, see <a href="https://link.springer.com/content/pdf/10.1023/A:1023949509487.pdf" class="external-link">Monti, Stefano, et al. “Consensus clustering: a resampling-based method for class discovery and visualization of gene expression microarray data.” Machine learning 52.1 (2003): 91-118.</a> The code and provided visualisations of <code>longmixr</code> is based on the <code>ConsensusClusterPlus</code> package, <a href="https://doi.org/10.1093/bioinformatics/btq170" class="external-link">Wilkerson, Matthew D., and D. Neil Hayes. “ConsensusClusterPlus: a class discovery tool with confidence assessments and item tracking.” Bioinformatics 26.12 (2010): 1572-1573.</a> In contrast to <code>ConsensusClusterPlus</code>, we use the package <code>flexmix</code>, <a href="https://doi.org/10.18637/jss.v028.i04" class="external-link">Grun, Bettina, and Friedrich Leisch. “FlexMix version 2: finite mixtures with concomitant variables and varying and constant parameters.” (2008): 1.</a>, instead of hierarchical clustering which allows us to model longitudinal data.</p>
</div>
<div class="section level1">
<h1 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h1>
<p>For the analysis, we use a simulated data set contained in <code>longmixr</code>. Please note that <code>longmixr</code> can only deal with complete data sets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fake_questionnaire_data"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fake_questionnaire_data</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    400 obs. of  20 variables:</span>
<span class="co">#&gt;  $ ID                        : chr  "person_1" "person_1" "person_1" "person_1" ...</span>
<span class="co">#&gt;  $ visit                     : int  1 2 3 4 1 2 3 4 1 2 ...</span>
<span class="co">#&gt;  $ group                     : Factor w/ 2 levels "A","B": 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ age_visit_1               : num  19 19 19 19 32 32 32 32 20 20 ...</span>
<span class="co">#&gt;  $ single_continuous_variable: num  1.18 1.18 1.18 1.18 0.81 ...</span>
<span class="co">#&gt;  $ questionnaire_A_1         : Factor w/ 5 levels "1","2","3","4",..: 2 2 3 3 2 2 3 4 2 2 ...</span>
<span class="co">#&gt;  $ questionnaire_A_2         : Factor w/ 5 levels "1","2","3","4",..: 2 2 1 1 2 2 1 1 2 2 ...</span>
<span class="co">#&gt;  $ questionnaire_A_3         : Factor w/ 5 levels "1","2","3","4",..: 2 2 1 1 3 2 1 1 2 1 ...</span>
<span class="co">#&gt;  $ questionnaire_A_4         : Factor w/ 5 levels "1","2","3","4",..: 2 1 1 2 2 2 1 1 2 2 ...</span>
<span class="co">#&gt;  $ questionnaire_A_5         : Factor w/ 5 levels "1","2","3","4",..: 2 4 4 5 3 4 5 5 1 3 ...</span>
<span class="co">#&gt;  $ questionnaire_B_1         : Factor w/ 5 levels "1","2","3","4",..: 1 2 4 5 2 3 4 5 1 3 ...</span>
<span class="co">#&gt;  $ questionnaire_B_2         : Factor w/ 5 levels "1","2","3","4",..: 1 1 2 4 1 2 4 5 1 2 ...</span>
<span class="co">#&gt;  $ questionnaire_B_3         : Factor w/ 5 levels "1","2","3","4",..: 1 1 2 1 2 2 2 2 2 2 ...</span>
<span class="co">#&gt;  $ questionnaire_B_4         : Factor w/ 5 levels "1","2","3","4",..: 1 1 1 1 1 2 2 1 1 1 ...</span>
<span class="co">#&gt;  $ questionnaire_B_5         : Factor w/ 5 levels "1","2","3","4",..: 1 2 1 1 1 4 2 3 1 1 ...</span>
<span class="co">#&gt;  $ questionnaire_C_1         : num  0.973 0.351 -3.715 -2.059 0.831 ...</span>
<span class="co">#&gt;  $ questionnaire_C_2         : num  -1.974 0.852 6.147 6.211 -3.231 ...</span>
<span class="co">#&gt;  $ questionnaire_C_3         : num  0.873 1.168 1.864 3.84 -0.34 ...</span>
<span class="co">#&gt;  $ questionnaire_C_4         : num  3.41 4.24 8.9 13.81 3.93 ...</span>
<span class="co">#&gt;  $ questionnaire_C_5         : num  0.264 1.586 0.459 1.747 1.866 ...</span></code></pre></div>
<p>The data set contains observations of 100 subjects at four different time points. The data was simulated in two groups which we try to recover in the analysis. For every individual, we have the information of</p>
<ul>
<li>the age at the first time point</li>
<li>questionnaire A which contains five items (or in other words variables) with the categorical levels 1 - 5</li>
<li>questionnaire B which contains five items (or in other words variables) with the categorical levels 1 - 5</li>
<li>questionnaire C which contains five continuous variables</li>
<li>one additional cross-sectional continuous variable</li>
</ul>
<p>Because the data set was simulated, it also contains the group variable from the simulation. In your data set you typically don’t have such a variable because you don’t know the groups. For the following analysis, the group variable is not required.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>It is recommended to first get an overview about the data distribution:</p>
<p>Age:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_visit_1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>The histogram shows no clear pattern in the age distribution.</p>
<p>Questionnaire A:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">visit</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_A"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">visit</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>,
    values_to <span class="op">=</span> <span class="st">"level"</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, fill <span class="op">=</span> <span class="va">level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">item</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>For each of the five items of the questionnaire, the distribution of the different levels (as counts) is shown for the four time points. The distribution of the levels seems to change across the time points for all items.</p>
<p>Questionnaire B:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">visit</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">visit</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>,
    values_to <span class="op">=</span> <span class="st">"level"</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, fill <span class="op">=</span> <span class="va">level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">item</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>For each of the five items of the questionnaire, the distribution of the different levels (as counts) is shown for the four time points. The distribution of the levels seems to change across the time points for some items.</p>
<p>Questionnaire C:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">visit</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_C"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">visit</span>,
    names_to <span class="op">=</span> <span class="st">"variable"</span>,
    values_to <span class="op">=</span> <span class="st">"value"</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">visit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>For each of the five variables of the questionnaire, the distribution is shown for the four time points as boxplots. The distribution changes for some variables across the time points.</p>
<p><code>single_continuous_variable</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># only use the values from the first visit as there is only one unique value</span>
  <span class="co"># per subject</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">single_continuous_variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>The distribution of this variable is shown as a boxplot.</p>
</div>
</div>
<div class="section level1">
<h1 id="dimension-reduction">Dimension reduction<a class="anchor" aria-label="anchor" href="#dimension-reduction"></a>
</h1>
<p>Especially if you have a lot of variables, it can make sense to reduce the dimensionality for your analysis. For demonstration purposes, we apply a dimension reduction approach also to the example data. For this, we use the function <code>FAMD</code> from the package <code>FactoMineR</code>. It uses a similar approach as PCA for categorical data. For better interpretability, we apply the dimension reduction per questionnaire.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">quest_A_dim</span> <span class="op">&lt;-</span> <span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_A"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/FAMD.html" class="external-link">FAMD</a></span><span class="op">(</span>ncp <span class="op">=</span> <span class="fl">5</span>, graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">quest_B_dim</span> <span class="op">&lt;-</span> <span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/FactoMineR/man/FAMD.html" class="external-link">FAMD</a></span><span class="op">(</span>ncp <span class="op">=</span> <span class="fl">5</span>, graph <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">quest_C_dim</span> <span class="op">&lt;-</span> <span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"questionnaire_C"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can use the elbow plot method to visually determine the number of components to include into the analysis. The following function plots the variance explained by each component.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eigenvalue.html" class="external-link">fviz_screeplot</a></span><span class="op">(</span><span class="va">quest_A_dim</span>, main <span class="op">=</span> <span class="st">"Questionnaire A"</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>In this case, we would only select the first three components as the others explain only a small amount of variance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eigenvalue.html" class="external-link">fviz_screeplot</a></span><span class="op">(</span><span class="va">quest_B_dim</span>, main <span class="op">=</span> <span class="st">"Questionnaire B"</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>From questionnaire B, we only include the first component.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eigenvalue.html" class="external-link">fviz_screeplot</a></span><span class="op">(</span><span class="va">quest_C_dim</span>, main <span class="op">=</span> <span class="st">"Questionnaire C"</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>From Questionnaire C, only include the first component.</p>
<p>Generate one data.frame for further use with the values of every individual in the new dimension reduced space:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">quest_A_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">quest_A_dim</span><span class="op">$</span><span class="va">ind</span><span class="op">$</span><span class="va">coord</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">quest_A_comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_A_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="va">quest_B_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">quest_B_dim</span><span class="op">$</span><span class="va">ind</span><span class="op">$</span><span class="va">coord</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">quest_B_comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_B_"</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">quest_C_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">quest_C_dim</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">quest_C_comp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_C_"</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
    ID <span class="op">=</span> <span class="va">fake_questionnaire_data</span><span class="op">$</span><span class="va">ID</span>,
    visit <span class="op">=</span> <span class="va">fake_questionnaire_data</span><span class="op">$</span><span class="va">visit</span>,
    age <span class="op">=</span> <span class="va">fake_questionnaire_data</span><span class="op">$</span><span class="va">age_visit_1</span>
  <span class="op">)</span>,
  <span class="va">quest_A_comp</span>,
  <span class="va">quest_B_comp</span>,
  <span class="va">quest_C_comp</span>
<span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h2>
<p>We can check how well the variables are correlated with the components and which variables contribute the most to the components found in the dimension reduction step. For the visualisation, we use functions from the <code>factoextra</code> package.</p>
<p>Questionnaire A:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_famd.html" class="external-link">fviz_famd_var</a></span><span class="op">(</span><span class="va">quest_A_dim</span>, repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html" class="external-link">fviz_contrib</a></span><span class="op">(</span><span class="va">quest_A_dim</span>, <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-13-2.png" width="576"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html" class="external-link">fviz_contrib</a></span><span class="op">(</span><span class="va">quest_A_dim</span>, <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-13-3.png" width="576"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html" class="external-link">fviz_contrib</a></span><span class="op">(</span><span class="va">quest_A_dim</span>, <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-13-4.png" width="576"></p>
<p>Questionnaire B:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_famd.html" class="external-link">fviz_famd_var</a></span><span class="op">(</span><span class="va">quest_B_dim</span>, repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html" class="external-link">fviz_contrib</a></span><span class="op">(</span><span class="va">quest_B_dim</span>, <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-14-2.png" width="576"></p>
<p>Questionnaire C:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html" class="external-link">fviz_pca_var</a></span><span class="op">(</span><span class="va">quest_C_dim</span>, repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_contrib.html" class="external-link">fviz_contrib</a></span><span class="op">(</span><span class="va">quest_C_dim</span>, <span class="st">"var"</span>, axes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-15-2.png" width="576"></p>
</div>
</div>
<div class="section level1">
<h1 id="effect-of-confounders">Effect of confounders<a class="anchor" aria-label="anchor" href="#effect-of-confounders"></a>
</h1>
<p>There can be confounders that have a known effect on your outcome which you don’t want to analyse. One solution is to first “regress them out” in a linear model and only work with the resulting residuals. The following steps are done with the components from the dimension reduction.</p>
<p>One example of the age effect in questionnaire A:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cluster_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">quest_A_1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Questionnaire A dimension 1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p>As a simple approach we use linear mixed models to regress out the age effect in all components used for the clustering:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># helper function to regress out the effect</span>
<span class="va">generate_residuals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">age</span>, <span class="va">ID</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">x</span>,
    age <span class="op">=</span> <span class="va">age</span>,
    ID <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
  <span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="va">resid</span>
<span class="op">}</span>

<span class="va">cluster_data_resid</span> <span class="op">&lt;-</span> <span class="va">cluster_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="co"># apply the function to all variables ending with a number</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"[1-9]$"</span><span class="op">)</span>,
                <span class="op">~</span><span class="fu">generate_residuals</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.x</span>, age <span class="op">=</span> <span class="va">age</span>, ID <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>,
                .names <span class="op">=</span> <span class="st">"{.col}_resid"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">visit</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"resid"</span><span class="op">)</span>, <span class="va">age</span><span class="op">)</span>
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span>
<span class="co">#&gt; boundary (singular) fit: see ?isSingular</span></code></pre></div>
<p>After the regression, the linear effect of age is not contained anymore in the residuals.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cluster_data_resid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">quest_A_1_resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Residuals of questionnaire A dimension 1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
</div>
<div class="section level1">
<h1 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h1>
<p>First we need to set up the models that are estimated and used to assign each observation a cluster. For every variable, one model is estimated.</p>
<p>First define the names of the variables. In our case, these are the components derived from the questionnaires and adjusted for the age effect:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">response_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_A_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"_resid"</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_B_"</span>, <span class="fl">1</span>, <span class="st">"_resid"</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"quest_C_"</span>, <span class="fl">1</span>, <span class="st">"_resid"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now, for every variable a <code>FLXMRmgcv</code> model is set up because this accommodates the longitudinal structure of our data. However, the <code>flexmix</code> framework is very flexible and the model can be changed to any other <code>FLXMR</code> model.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">response_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">flexmix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexmix/man/FLXMRmgcv.html" class="external-link">FLXMRmgcv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" ~ ."</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The <code>~ .</code> part means that actual model (how the outcome is modeled from the independent variables) is not yet defined. This will be defined as an argument to the <code>longitudinal_consensus_cluster</code> function.</p>
<p>We use the function with the following parameters:</p>
<ul>
<li>
<code>data = cluster_data_resid</code> the data as a <code>data.frame</code> with observations in the rows and the variables in the columns.</li>
<li>
<code>id_column = ID</code> defines which variable in the provided data is the ID column to correctly name the output.</li>
<li>
<code>max_k = 3</code> the maximum number of clusters that is tried out; in this case solutions with 2 and 3 clusters will be tried out. You should set this argument as high as you expect that an optimal solution could be. Using a higher <code>max_k</code> increases the computational cost.</li>
<li>
<code>reps = 5</code> the number how often the data is subsetted and the clustering is repeated (in other words: the number of subsets). Here, we use a small number to keep the run time short for the example, in general the higher the number the more accurate the results.</li>
<li>
<code>p_item = 0.8</code> the fraction of observations that is included in a subset (for a definition of subset see the above <code>reps</code> description).</li>
<li>
<code>model_list = list_models</code> the predefined <code>flexmix</code> models used for the clustering.</li>
<li>
<code>flexmix_formula = as.formula("~s(visit, k = 4) | ID")</code> formula how the response should be modeled; here the outcome is modeled as a smooth function of the time while taking the repeated measurements of one subject into account.</li>
<li>
<code>final_linkage = "ward.D2"</code> the linkage that is used for the final hierarchical clustering step on the consensus matrix.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2378</span><span class="op">)</span>
<span class="va">cluster_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/longitudinal_consensus_cluster.html">longitudinal_consensus_cluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cluster_data_resid</span>,
                                                id_column <span class="op">=</span> <span class="st">"ID"</span>,
                                                max_k <span class="op">=</span> <span class="fl">3</span>,
                                                reps <span class="op">=</span> <span class="fl">5</span>,
                                                p_item <span class="op">=</span> <span class="fl">0.8</span>,
                                                model_list <span class="op">=</span> <span class="va">list_models</span>,
                                                flexmix_formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="st">"~s(visit, k = 4) | ID"</span><span class="op">)</span>,
                                                final_linkage <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span>
<span class="co">#&gt; 2 : *</span>
<span class="co">#&gt; 3 : *</span>
<span class="co">#&gt; 2 : *</span>
<span class="co">#&gt; 3 : *</span>
<span class="co">#&gt; 2 : *</span>
<span class="co">#&gt; 3 : *</span>
<span class="co">#&gt; 2 : *</span>
<span class="co">#&gt; 3 : *</span>
<span class="co">#&gt; 2 : *</span>
<span class="co">#&gt; 3 : *</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="analyse-the-clustering">Analyse the clustering<a class="anchor" aria-label="anchor" href="#analyse-the-clustering"></a>
</h1>
<div class="section level2">
<h2 id="determine-the-best-clustering">Determine the best clustering<a class="anchor" aria-label="anchor" href="#determine-the-best-clustering"></a>
</h2>
<p>First, plot the analysis plots provided by <code>longmixr</code>. They are the same provided by the <code>ConsensusClusterPlus</code> package which is the basis for <code>longmixr</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cluster_model</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-1.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-2.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-3.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-4.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-5.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-6.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-7.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-22-8.png" width="576"></p>
<p>Especially useful are the consensus matrix plots and the item-consensus plot. The consensus matrix plot shows for every pair of subjects/IDs how often they are clustered together in one cluster. Every row and every column represents one subject. A value of 1 (dark blue) means that these two subjects always cluster together, a value of 0 (white) means that these two subjects never cluster together. The first plot shows only the legend for the consensus matrix plots without any other information.</p>
<p>For an optimal solution, you want to see clearly separated clusters that are all dark blue. In this example, this is the case for a two cluster solution and less so for a three cluster solution.</p>
<p>The consensus matrix plots also mention the “median flexmix clusters”. This is because in some cases, the flexmix model does not find as many clusters as specified but less. To get a short overview about this, we include the median number of clusters. For a more detailed analysis, the information about the found number of clusters is contained in the return value for every cluster solution as <code>found_flexmix_clusters</code>.</p>
<p>In the consensus cumulative distribution function (CDF) plot, the optimal cases shows a straight horizontal line with a sharp increase at 0 and 1. In the example, this is more fulfilled for the two cluster solution than the three cluster solution. However, the sharp increase at 0 is not visible in our example.</p>
<p>The Delta area plot is generated to be consistent with <code>ConsensusClusterPlus</code>, but we don’t recommend to use it.</p>
<p>The tracking plot shows for every subject to which cluster it was assigned to across the different possible cluster solutions with different numbers of clusters.</p>
<p>The item-consensus plot shows every item (subject) on the x-axis. For every subject, the mean consensus value with all other subjects assigned to one cluster is calculated.</p>
<p>In the item-consensus plot for two clusters, the mean item consensus for all subjects assigned to cluster 1 are only calculated for cluster 1, because no subject is assigned to cluster 2. Accordingly, the mean item consensus for all subjects assigned to cluster 2 are only calculated for cluster 2, because no subject is assigned to cluster 1.</p>
<p>In the item-consensus plot for three clusters, some subjects are assigned to different clusters in different subsampling steps. Therefore, for these items the mean item-consensus is shown for cluster 2 and cluster 3. In general, for a given subject you want to have a high item-consensus for one cluster and low item-consensus for all other clusters.</p>
<p>In the example, the item-consensus plots suggest a two cluster solution fits the data best.</p>
</div>
<div class="section level2">
<h2 id="visualise-the-clusters">Visualise the clusters<a class="anchor" aria-label="anchor" href="#visualise-the-clusters"></a>
</h2>
<p>First extract the cluster information (only for the two cluster solution) from the model:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cluster_assignments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clusters.html">get_clusters</a></span><span class="op">(</span><span class="va">cluster_model</span>, number_clusters <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The extracted assignments <code>data.frame</code> also includes the ID column with the name specified by the user in the <code>longitudinal_consensus_cluster</code> function, so we can easily join it with the original data:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">original_data</span> <span class="op">&lt;-</span> <span class="va">fake_questionnaire_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cluster_assignments</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span>
<span class="va">cluster_data_resid</span> <span class="op">&lt;-</span> <span class="va">cluster_data_resid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cluster_assignments</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="components-used-in-clustering">Components used in clustering<a class="anchor" aria-label="anchor" href="#components-used-in-clustering"></a>
</h3>
<p>Now the components used for the clustering can be visualised as spaghetti plots. First, define the plotting function:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_spaghetti</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span> <span class="op">=</span> <span class="va">cluster_data_resid</span>,
                           <span class="va">num_clus</span> <span class="op">=</span> <span class="fl">2</span>,
                           <span class="va">var_type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quest_A"</span>, <span class="st">"quest_B"</span>, <span class="st">"quest_C"</span><span class="op">)</span>,
                           <span class="va">var_nums</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,
                           <span class="va">scale_arg</span> <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">var_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">var_type</span><span class="op">)</span>
  <span class="va">clus_assign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"assignment_num_clus_"</span>, <span class="va">num_clus</span><span class="op">)</span>
  
  <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>
      cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">var_type</span>, <span class="st">"_"</span>, <span class="va">var_nums</span>, <span class="st">"_resid"</span><span class="op">)</span>,
      names_to <span class="op">=</span> <span class="st">"variable"</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="co"># this step to create a patient_idID per variable is needed, otherwise</span>
    <span class="co"># ggplot can't differentiate between the different variables</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ID</span>, <span class="st">"_"</span>, <span class="va">variable</span><span class="op">)</span>,
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">variable</span>, <span class="va">ID</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">additional_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">value</span>, <span class="va">variable</span>, <span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">variable</span>, <span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
              sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">additional_data</span>,
                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">mean</span>, ymin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">sd</span>, ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span>,
                              fill <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">additional_data</span>,
              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>,
              size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, scales <span class="op">=</span> <span class="va">scale_arg</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Questionnaire A:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_spaghetti</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, var_type <span class="op">=</span> <span class="st">"quest_A"</span>, var_nums <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<p>Questionnaire B:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_spaghetti</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, var_type <span class="op">=</span> <span class="st">"quest_B"</span>, var_nums <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>Questionnaire C:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_spaghetti</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, var_type <span class="op">=</span> <span class="st">"quest_C"</span>, var_nums <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="original-data">Original data<a class="anchor" aria-label="anchor" href="#original-data"></a>
</h3>
<p>Most of the original variables are categorical variables. For a better visualisation of the change over time, we use alluvial plots and plot every item (variable) separately.</p>
<p>Define the plotting function for alluvial plots:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_alluvial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span> <span class="op">=</span> <span class="va">original_data</span>,
                          <span class="va">num_clus</span> <span class="op">=</span> <span class="fl">2</span>,
                          <span class="va">var_name</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">clus_assign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"assignment_num_clus_"</span>, <span class="va">num_clus</span><span class="op">)</span>
  
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>,
               stratum <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">var_name</span><span class="op">]</span><span class="op">]</span>,
               alluvium <span class="op">=</span> <span class="va">ID</span>,
               fill <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">var_name</span><span class="op">]</span><span class="op">]</span>,
               label <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">var_name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_flow.html" class="external-link">geom_flow</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"alluvium"</span>, lode.guidance <span class="op">=</span> <span class="st">"frontback"</span>,
              color <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html" class="external-link">geom_stratum</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"number of subjects"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Distribution of "</span>, <span class="va">var_name</span>, <span class="st">" across clusters"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Questionnaire A:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^questionnaire_A"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="op">~</span><span class="fu">plot_alluvial</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, var_name <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-30-1.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-30-2.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-30-3.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-30-4.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-30-5.png" width="576"></p>
<p>Questionnaire B:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^questionnaire_B"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="op">~</span><span class="fu">plot_alluvial</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, var_name <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-31-1.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-31-2.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-31-3.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-31-4.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-31-5.png" width="576"></p>
<p>Questionnaire C:</p>
<p>As questionnaire C contains continuous variables, use again a spaghetti plot:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first define plot function similar to the first spaghetti plot function but</span>
<span class="co"># suited for the original data</span>
<span class="va">plot_spaghetti_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,
                             <span class="va">var_name</span>,
                             <span class="va">num_clus</span> <span class="op">=</span> <span class="fl">2</span>,
                             <span class="va">scale_arg</span> <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">clus_assign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"assignment_num_clus_"</span>, <span class="va">num_clus</span><span class="op">)</span>
  <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>
      cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">var_name</span><span class="op">)</span>,
      names_to <span class="op">=</span> <span class="st">"variable"</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="co"># this step to create a ID per variable is needed, otherwise</span>
    <span class="co"># ggplot can't differentiate between the different variables</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ID</span>, <span class="st">"_"</span>, <span class="va">variable</span><span class="op">)</span>,
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">variable</span>, <span class="va">ID</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">additional_data</span> <span class="op">&lt;-</span> <span class="va">plot_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">value</span>, <span class="va">variable</span>, <span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">visit</span>, <span class="va">variable</span>, <span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
              sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">ID</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">additional_data</span>,
                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">mean</span>, ymin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">sd</span>, ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span>,
                              fill <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">additional_data</span>,
              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">visit</span>, y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>,
              size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">clus_assign</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, scales <span class="op">=</span> <span class="va">scale_arg</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^questionnaire_C"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">original_data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="op">~</span><span class="fu">plot_spaghetti_2</span><span class="op">(</span>num_clus <span class="op">=</span> <span class="fl">2</span>, data <span class="op">=</span> <span class="va">original_data</span>, var_name <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-33-1.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-33-2.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-33-3.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-33-4.png" width="576"><img src="analysis_workflow_files/figure-html/unnamed-chunk-33-5.png" width="576"></p>
<p>The comparison of the two clusters regarding the original variables show differences how some items of the categorical questionnaires and some variables of the continuous questionnaires differ between the two clusters.</p>
</div>
<div class="section level3">
<h3 id="cluster-comparison">Cluster comparison<a class="anchor" aria-label="anchor" href="#cluster-comparison"></a>
</h3>
<p>As a final step, variables that were not used in the clustering, for example cross-sectional variables, can be compared across the found clusters. In this case, <code>single_continuous_variable</code> only has one value per subject and was left out from the clustering:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">original_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">assignment_num_clus_2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cluster</span>, y <span class="op">=</span> <span class="va">single_continuous_variable</span>,
             fill <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="analysis_workflow_files/figure-html/unnamed-chunk-34-1.png" width="576"></p>
<p>Also the left-out variable shows a different behaviour between the two clusters.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonas Hagenberg, Matt Wilkerson, Peter Waltman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
